<div>
  <!-- end game button -->
  <div class="text-right">
    <button type="button" class="btn btn-outline-primary" (click)="endGame()">End Game</button>
  </div>

  <!-- loyalty -->
  <div class="mt-3 border-top border-bottom">
    <div class="text-right small" (click)="toggleDisplayLoyalty()">
      <div *ngIf="!displayLoyalty">Show</div>
      <div *ngIf="displayLoyalty">Hide</div>
    </div>
    <div *ngIf="displayLoyalty"class="h4 mb-3 text-center">You are on team {{loyalty}}</div>
  </div>

  <!-- quest results -->
  <div class="text-center mt-4">
    <div class="h5">Quest Results</div>
    <div class="row">
      <div *ngFor="let roundNumber of [0,1,2,3,4]" class="w-20 mx-1 p-1 border col" [ngClass]="getQuestResultBorderClass(roundNumber)">
        <div class="scaling-text">Round {{roundNumber+1}}</div>
        <div class="h5 m-0">{{roundNumber >= game.currentRound ? TEAM_SIZES[game.players.length][roundNumber] : game.missionResults[roundNumber] ? "Pass" : "Fail"}}</div>
        <div *ngIf="roundNumber == 3 && game.players.length >= 7" class="small no-line-height">*Two fails required</div>
      </div>
    </div>
  </div>

  <!-- failed vote counter -->
  <div class="mt-2">
    <div>Failed Votes: {{game.failedVotes}} (Evil wins at 5)</div>
  </div>

  <!-- player list -->
  <div class="mt-4">
    <div class="d-flex justify-content-between">
      <div class="h5">Players</div>
      <fa-icon [icon]="faQuestionCircle" (click)="displayLegend = !displayLegend"></fa-icon>
    </div>
    <div *ngIf="displayLegend" class="border-top border-bottom py-2">
      <div>L: Leader</div>
      <div>E: Players on team Evil (can only see if you are Evil)</div>
      <div>T: Players selected for quest team</div>
      <div>V: During vote phase, players who have voted</div>
      <div>Q: During quest phase, players who have quested</div>
    </div>
    <div class="mt-1 d-flex flex-wrap">
      <div *ngFor="let currPlayer of game.players" class="item">
        <div class="p-1 bg-light d-flex flex-row align-items-center">
          <div class="flex-grow-1">{{currPlayer.name}}</div>
          <div *ngIf="currPlayer._id === currentLeader._id" class="small mx-1">L</div>
          <div *ngIf="player.loyalty === loyaltyEnum.Evil && displayLoyalty && currPlayer.loyalty === loyaltyEnum.Evil" class="small mx-1">E</div>
          <div *ngIf="game.currentTeam.includes(currPlayer._id)" class="small mx-1">T</div>
          <div *ngIf="game.phase === gamePhases.Vote && currPlayer.hasVoted" class="small mx-1">V</div>
          <div *ngIf="game.phase === gamePhases.Quest && game.currentTeam.includes(currPlayer._id) && currPlayer.hasQuested" class="small mx-1">Q</div>
        </div>
      </div>
    </div>
  </div>

  <!-- previous phase results -->
  <!-- Game has started -->
  <ngb-alert *ngIf="phaseChangeStatus === phaseChangeStatuses.LobbyToSelection" (close)="phaseChangeStatus = null" class="mt-4">
    <div>Game has started</div>
  </ngb-alert>

  <!-- Previous round's quest results -->
  <ngb-alert *ngIf="phaseChangeStatus === phaseChangeStatuses.QuestToSelection" (close)="phaseChangeStatus = null" class="mt-4">
    <div *ngIf="game.missionResults[game.currentRound-1]">Quest Succeeded</div>
    <div *ngIf="!game.missionResults[game.currentRound-1]">Quest Failed</div>
    <div>Quest Breakdown:</div>
    <div>{{previousPasses}} Passes, {{previousFails}} Fails</div>
  </ngb-alert>

  <!-- Vote results -->
  <ngb-alert *ngIf="phaseChangeStatus === phaseChangeStatuses.VoteToSelection || phaseChangeStatus === phaseChangeStatuses.VoteToQuest" (close)="phaseChangeStatus = null" class="mt-4">
    <div *ngIf="phaseChangeStatus === phaseChangeStatuses.VoteToSelection">Vote did not pass</div>
    <div *ngIf="phaseChangeStatus === phaseChangeStatuses.VoteToQuest">Vote passed</div>
    <div class="mt-1">
      <div>Vote breakdown:</div>
      <div class="d-flex flex-row flex-wrap mt-1">
        <div *ngFor="let currPlayer of game.players" class="w-50">
          <div class="col d-flex flex-row justify-content-between mx-2">
            <div>{{currPlayer.name}}</div>
            <div *ngIf="currPlayer.currentVote">Yes</div>
            <div *ngIf="!currPlayer.currentVote">No</div>
          </div>
        </div>
      </div>
    </div>
  </ngb-alert>

  <!-- Proposed Team -->
  <ngb-alert *ngIf="phaseChangeStatus === phaseChangeStatuses.SelectionToVote" (close)="phaseChangeStatus = null" class="mt-4">
    <div>Proposed Team</div>
    <div class="d-flex flex-row flex-wrap mt-1">
      <div *ngFor="let currPlayer of currentTeamPlayers" class="w-50">
        <div class="col">{{currPlayer.name}}</div>
        <div *ngIf="game.phase === gamePhases.Quest && currPlayer.hasQuested" class="col small">Q</div>
      </div>
    </div>
  </ngb-alert>

  <!-- Phase specific view -->
  <div *ngIf="game.phase == gamePhases.Selection"><app-selection [game]=game [playerId]=playerId [currentLeader]=currentLeader></app-selection></div>
  <div *ngIf="game.phase == gamePhases.Vote"><app-vote [game]=game [playerId]=playerId [player]=player></app-vote></div>
  <div *ngIf="game.phase == gamePhases.Quest"><app-quest [game]=game [playerId]=playerId [player]=player></app-quest></div>
</div>
